# 角色提取功能使用指南

## 快速开始

### 第一步：准备剧本内容

在使用角色提取功能之前，确保你的项目中已经有剧集和剧本内容：

1. 进入项目的"剧本"页面
2. 可以通过以下方式添加剧本：
   - 点击"导入小说"，AI自动拆分成剧集
   - 点击"新建剧集"，手动创建剧集并填写剧本内容

### 第二步：提取角色

1. 在"剧本"页面，点击顶部的 **"✨ 提取角色"** 按钮
2. AI开始分析剧本内容（通常需要10-30秒）
3. 等待提取完成

### 第三步：预览和编辑

提取完成后，你会看到一个预览界面：

#### 左侧：角色列表
- 显示所有提取的角色
- 绿色"新角色"徽章：表示这是新发现的角色
- 灰色"已存在"徽章：表示角色已在系统中，将添加新造型
- 勾选框：选择要导入的角色
- 点击角色卡片可以在右侧查看详情

#### 右侧：详情编辑
- **角色名称**：可以修改角色的名字
- **性格描述**：AI提取的性格特征，可以编辑
- **基础外貌**：固定不变的特征（如发色、瞳色、身高等）
- **造型列表**：
  - 每个造型包含名称和图像生成prompt
  - 可以编辑、删除或添加新造型
  - prompt是英文描述，用于后续生成图片

#### 底部操作栏
- 显示已选择的角色数和造型数
- "全选/取消全选"按钮
- "确认导入"按钮

### 第四步：确认导入

1. 检查并编辑提取的信息
2. 确保选中了要导入的角色
3. 点击"确认导入"按钮
4. 等待导入完成（通常很快）

### 第五步：查看结果

导入成功后：
- 显示导入统计（新增角色数、新增造型数等）
- 3秒后自动跳转到"角色管理"页面
- 新导入的角色会有高亮效果和"新导入"徽章
- 高亮效果3秒后自动消失

### 第六步：生成造型图片

在角色管理页面：
1. 点击角色卡片进入详情
2. 在"造型设定"标签页
3. 点击每个造型的"生成图片"按钮
4. AI会根据prompt生成图片
5. 选择满意的图片保存

## 使用技巧

### 1. 剧本内容建议

为了获得更好的提取效果，剧本内容应该：
- 包含角色的对话和动作描述
- 提及角色的外貌特征
- 描述角色在不同场景的表现
- 至少让每个主要角色出现2次以上

**好的剧本示例**：
```
【第1集：初遇】

场景：咖啡厅，下午

李雪（长发飘飘的年轻女孩，穿着白色连衣裙）走进咖啡厅，
环顾四周，目光落在角落的张明身上。

张明（戴着黑框眼镜的程序员，穿着格子衬衫）正专注地
敲击着笔记本电脑，没有注意到李雪的到来...
```

### 2. 编辑技巧

**基础外貌 vs 造型描述**：
- 基础外貌：写固定不变的特征
  - ✅ "黑色长发、蓝色瞳孔、身高170cm"
  - ❌ "穿着白色连衣裙"（这是造型）
  
- 造型描述：写可变的元素
  - ✅ "白色连衣裙、珍珠项链、淡妆"
  - ❌ "黑色长发"（这是基础外貌）

**Prompt编辑**：
- AI生成的prompt已经是专业格式
- 如果需要调整，保持英文格式
- 包含：人物特征 + 服装 + 场景 + 风格
- 例如：`"A young woman with long black hair and blue eyes, wearing white dress, in a coffee shop, natural lighting, high quality, detailed"`

### 3. 智能合并

如果角色已存在：
- 系统会保留原有的基本信息
- 只添加新的造型（不重复）
- 如果AI提取的描述更详细，会更新描述

**示例**：
- 原有角色"李雪"：1个造型（日常装）
- 新提取"李雪"：3个造型（日常装、工作装、晚礼服）
- 导入后：李雪有4个造型（去重后：日常装、工作装、晚礼服）

### 4. 批量操作

- 使用"全选"快速选择所有角色
- 可以取消勾选不需要的角色
- 一次可以导入多个角色
- 编辑会实时保存在浏览器中

## 常见问题

### Q1: 提取失败怎么办？

**可能原因**：
- 剧本内容太少或没有角色描述
- OpenAI API配置错误
- 网络连接问题

**解决方法**：
- 检查剧本内容是否包含角色信息
- 点击"重试"按钮
- 联系管理员检查API配置

### Q2: 提取的角色不准确？

**原因**：
- AI理解有偏差
- 剧本描述不够清晰

**解决方法**：
- 在预览界面手动编辑信息
- 删除不需要的造型
- 添加遗漏的造型
- 完善剧本描述后重新提取

### Q3: 造型的prompt是什么？

Prompt是给AI绘图工具的指令，用于生成图片。格式通常是：
```
A [角色特征], wearing [服装], [场景], [风格], high quality, detailed
```

你不需要完全理解，AI已经帮你生成好了。如果要修改，保持英文格式即可。

### Q4: 可以重复提取吗？

可以！系统会智能合并：
- 已存在的角色只添加新造型
- 不会创建重复的角色
- 不会创建重复的造型（通过名称判断）

### Q5: 提取后可以修改吗？

可以！有两个时机：
1. **导入前**：在预览界面直接编辑
2. **导入后**：在角色管理页面点击角色进入详情编辑

### Q6: 为什么有些角色没有被提取？

可能原因：
- 角色只出现1次（AI认为是配角）
- 角色没有对话或动作描述
- 剧本中没有提及角色名字

解决方法：
- 在角色管理页面手动创建
- 完善剧本后重新提取

## 最佳实践

### 工作流程建议

1. **先导入小说** → 自动拆分成剧集
2. **检查剧本内容** → 确保包含角色描述
3. **提取角色** → 一键AI分析
4. **精细编辑** → 调整不准确的信息
5. **导入确认** → 保存到系统
6. **生成图片** → 为每个造型生成视觉形象
7. **创建分镜** → 使用角色生成分镜画面

### 团队协作

- 编剧负责：完善剧本内容
- 角色设计师负责：提取和编辑角色信息
- 美术负责：生成和选择造型图片
- 导演负责：最终审核和调整

## 快捷键（计划中）

- `Enter`: 确认导入
- `Esc`: 取消/关闭
- `Space`: 勾选/取消勾选当前角色
- `↑/↓`: 切换角色
- `Ctrl+A`: 全选

## 反馈和支持

如果遇到问题或有建议：
1. 查看错误提示信息
2. 尝试重试操作
3. 联系技术支持
4. 提交功能建议

---

**提示**：角色提取功能使用AI技术，提取结果可能需要人工审核和调整。建议在导入前仔细检查信息的准确性。

