# åˆ†é•œæ¦‚å¿µåˆ é™¤ - é‡æ„å®ŒæˆæŠ¥å‘Š

## ğŸ“… å®Œæˆæ—¶é—´
2025-12-31

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯æ ¸å¿ƒé‡æ„

#### Agent Executor (src/lib/actions/agent/executor.ts)
- âœ… åˆ é™¤ `case "create_shots"`
- âœ… æ›¿æ¢ `case "generate_shot_video"` â†’ `case "generate_video"`
- âœ… æ›¿æ¢ `case "update_shots"` â†’ `case "update_videos"`
- âœ… æ›¿æ¢ `case "delete_shots"` â†’ `case "delete_videos"`
- âœ… æ›´æ–°å¯¼å…¥è¯­å¥ï¼Œä½¿ç”¨æ–°çš„ video actions

#### Agent Validation (src/lib/actions/agent/validation.ts)
- âœ… åˆ é™¤ `validateGenerateShotVideoParams` å‡½æ•°
- âœ… åˆ é™¤ `validateCreateShotsParams` å‡½æ•°
- âœ… æ·»åŠ  `validateGenerateVideoParams` å‡½æ•°
- âœ… æ›´æ–° switch caseï¼Œç§»é™¤æ‰€æœ‰åˆ†é•œç›¸å…³çš„éªŒè¯

#### Job Workers (src/lib/workers/)
- âœ… é‡å†™ `processors/video-processors.ts`
  - åˆ é™¤ `processShotVideoGeneration` å‡½æ•°
  - æ›´æ–° `processVideoGeneration` ä½¿ç”¨æ–°çš„ video è¡¨
  - æ›´æ–° `processFinalVideoExport` ä½¿ç”¨ videoIds è€Œä¸æ˜¯ episodeId
- âœ… æ›´æ–° `job-processor.ts`
  - åˆ é™¤ `shot_video_generation` å¤„ç†å™¨æ³¨å†Œ
  - ä¿ç•™ `video_generation` å’Œ `final_video_export`

#### ç§¯åˆ†ä¼°ç®— (src/lib/actions/credits/estimate.ts)
- âœ… åˆ é™¤åˆ†é•œæŸ¥è¯¢é€»è¾‘
- âœ… ç®€åŒ–ä¸ºç›´æ¥è®¡ç®—ç§¯åˆ†

### 2. å‰ç«¯ç»„ä»¶æ¸…ç†

#### å·²åˆ é™¤çš„ç»„ä»¶
- âœ… `/src/components/projects/editor/preview-panel/shot-asset-gallery.tsx`
- âœ… `/src/components/projects/editor/preview-panel/shot-asset-label-editor.tsx`
- âœ… `/src/components/projects/editor/preview-panel/shot-editor.tsx`
- âœ… `/src/components/projects/editor/preview-panel/shot-playback-player.tsx`
- âœ… `/src/components/projects/editor/timeline/shot-clip.tsx`
- âœ… `/src/components/projects/editor/timeline/timeline-container.tsx`
- âœ… `/src/components/projects/editor/timeline/timeline-ruler.tsx`
- âœ… `/src/components/projects/editor/timeline/timeline-toolbar.tsx`
- âœ… `/src/components/projects/editor/timeline/timeline-track.tsx`

#### å·²æ›´æ–°çš„ç»„ä»¶
- âœ… `/src/components/projects/editor/preview-panel/preview-panel.tsx`
  - åˆ é™¤ ShotEditor å’Œ ShotPlaybackPlayer å¼•ç”¨
  - åˆ é™¤æ’­æ”¾æ¨¡å¼ç›¸å…³é€»è¾‘
  - åˆ é™¤ `case "shot"` åˆ†æ”¯

### 3. å¸¸é‡å’Œå·¥å…·å‡½æ•°æ¸…ç†

#### å·²åˆ é™¤çš„æ–‡ä»¶
- âœ… `/src/lib/constants/shot-asset-labels.ts`
- âœ… `/src/lib/prompts/shot.ts`
- âœ… `/src/lib/utils/shot-utils.ts`

#### å·²æ›´æ–°çš„æ–‡ä»¶
- âœ… `/src/lib/constants/enums.ts`
  - åˆ é™¤ `SHOT_SIZE_ENUM`
  - åˆ é™¤ `CAMERA_MOVEMENT_ENUM`
  - åˆ é™¤ `mapApiToDb` å‡½æ•°
  - æ›´æ–° `getAllEnumLabels` å‡½æ•°

### 4. ç±»å‹å®šä¹‰
- âœ… æ‰€æœ‰åˆ†é•œç›¸å…³ç±»å‹å·²åœ¨ä¹‹å‰çš„é‡æ„ä¸­åˆ é™¤ï¼ˆ`ShotDetail`, `ShotSize`, `CameraMovement` ç­‰ï¼‰

## âš ï¸ éœ€è¦æ³¨æ„çš„é—ç•™é—®é¢˜

### 1. å‰ç«¯ç¼–è¾‘å™¨ä¸Šä¸‹æ–‡ (éœ€è¦ç”¨æˆ·å¤„ç†)
ä»¥ä¸‹æ–‡ä»¶ä»åŒ…å«åˆ†é•œç›¸å…³çš„çŠ¶æ€ç®¡ç†ï¼Œä½†ç”±äºæ¶‰åŠå¤æ‚çš„å‰ç«¯æ¶æ„ï¼Œå»ºè®®è°¨æ…å¤„ç†ï¼š

- `/src/components/projects/editor/editor-context.tsx`
  - åŒ…å« `shots` çŠ¶æ€
  - åŒ…å« `selectedShotIds` çŠ¶æ€
  - åŒ…å« `playbackState` çŠ¶æ€
  - åŒ…å«åˆ†é•œç›¸å…³çš„ actions å’Œ reducers
  
- `/src/components/projects/editor/editor-layout.tsx`
  - å¯èƒ½å¼•ç”¨äº†æ—¶é—´è½´ç»„ä»¶

- `/src/components/projects/editor/agent-panel/pending-action-message.tsx`
  - åŒ…å«åˆ†é•œæ“ä½œçš„æ˜¾ç¤ºé€»è¾‘ï¼ˆ`isCreateShots`, `isUpdateShots`, `isGenerateShotVideo`ï¼‰
  - åŒ…å«åˆ†é•œå‚æ•°çš„è§£æå’Œå±•ç¤º

**å»ºè®®ï¼š** è¿™äº›æ–‡ä»¶éœ€è¦å¤§è§„æ¨¡é‡æ„ï¼Œå»ºè®®åˆ›å»ºæ–°çš„è§†é¢‘ç®¡ç† UI æ¥æ›¿ä»£ã€‚

### 2. å›½é™…åŒ–æ–‡ä»¶
`/messages/zh.json` å’Œ `/messages/en.json` ä¸­ä»æœ‰å¤§é‡åˆ†é•œç›¸å…³çš„æ–‡æ¡ˆï¼ŒåŒ…æ‹¬ï¼š
- å·¥ä½œæµæ­¥éª¤æè¿°
- é”™è¯¯æ¶ˆæ¯
- æˆåŠŸæ¶ˆæ¯
- Agent å»ºè®®å¡ç‰‡
- æ—¶é—´è½´ç›¸å…³æ–‡æ¡ˆ

**å»ºè®®ï¼š** å¯ä»¥é€æ­¥æ¸…ç†ï¼Œæˆ–è€…åœ¨æ–° UI å¼€å‘æ—¶ä¸€å¹¶æ›´æ–°ã€‚

### 3. å…¶ä»–å¯èƒ½çš„å¼•ç”¨
ä»¥ä¸‹æ–‡ä»¶å¯èƒ½è¿˜åŒ…å« "shot" å…³é”®å­—çš„å¼•ç”¨ï¼ˆéœ€è¦é€ä¸ªæ£€æŸ¥ï¼‰ï¼š
- `src/lib/utils/motion-prompt.ts`
- `src/lib/utils/action-description-generator.ts`
- `src/lib/utils/agent-params-formatter.ts`
- `src/lib/actions/agent/context-collector.ts`
- `src/hooks/use-task-refresh.ts`
- `src/lib/constants/task-labels.tsx`

## ğŸ¯ æ ¸å¿ƒç†å¿µå˜åŒ–

**ä¹‹å‰ï¼š**
```
å‰§æœ¬ â†’ åˆ†é•œï¼ˆshotï¼‰ â†’ åˆ†é•œè§†é¢‘ â†’ å¯¼å‡º
```

**ç°åœ¨ï¼š**
```
éœ€æ±‚ â†’ è§†é¢‘ç‰‡æ®µï¼ˆvideoï¼‰ â†’ ç»„åˆ/å‰ªè¾‘ â†’ å¯¼å‡º
```

**å…³é”®ä¼˜åŠ¿ï¼š**
- Agent å¯ä»¥ç›´æ¥ç†è§£è§†é¢‘å†…å®¹ï¼ˆé€šè¿‡ promptï¼‰
- æ›´çµæ´»çš„è§†é¢‘ç”Ÿæˆå’Œç»„åˆ
- æ²¡æœ‰ä¸­é—´å±‚çš„é™åˆ¶
- æ›´ç¬¦åˆ AI è§†é¢‘ç”Ÿæˆçš„å®é™…å·¥ä½œæµ

## ğŸ“‹ æµ‹è¯•å»ºè®®

### åç«¯æµ‹è¯•
1. **Video Actions**
   - âœ… åˆ›å»ºè§†é¢‘ç”Ÿæˆä»»åŠ¡
   - âœ… æŸ¥è¯¢è§†é¢‘åˆ—è¡¨
   - âœ… æ›´æ–°è§†é¢‘ä¿¡æ¯
   - âœ… åˆ é™¤è§†é¢‘

2. **Agent æµ‹è¯•**
   - âœ… `query_context` - è¿”å›è§†é¢‘åˆ—è¡¨
   - âœ… `query_videos` - æŸ¥è¯¢è§†é¢‘
   - âœ… `generate_video` - ç”Ÿæˆæ–°è§†é¢‘
   - âœ… `update_videos` - ä¿®æ”¹è§†é¢‘
   - âœ… `delete_videos` - åˆ é™¤è§†é¢‘

### Worker æµ‹è¯•
- âœ… `video_generation` - è§†é¢‘ç”Ÿæˆä»»åŠ¡
- âœ… `final_video_export` - æœ€ç»ˆå¯¼å‡ºä»»åŠ¡

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### çŸ­æœŸï¼ˆå¿…é¡»ï¼‰
1. **æ•°æ®åº“è¿ç§»**
   - è¿è¡Œè¿ç§»è„šæœ¬åˆ›å»º `video` è¡¨
   - åˆ é™¤ `shot`, `shot_asset`, `shot_video`, `shot_transition` è¡¨
   - åˆ é™¤ç›¸å…³çš„ enum ç±»å‹

2. **æµ‹è¯•åç«¯åŠŸèƒ½**
   - æµ‹è¯• Agent çš„è§†é¢‘ç”ŸæˆåŠŸèƒ½
   - æµ‹è¯• Worker çš„è§†é¢‘å¤„ç†
   - ç¡®ä¿ç§¯åˆ†æ‰£é™¤æ­£å¸¸

### ä¸­æœŸï¼ˆå»ºè®®ï¼‰
1. **åˆ›å»ºæ–°çš„è§†é¢‘ç®¡ç† UI**
   - è§†é¢‘åº“ç½‘æ ¼å±•ç¤º
   - è§†é¢‘å¡ç‰‡ç»„ä»¶
   - è§†é¢‘ç¼–è¾‘å™¨
   - è§†é¢‘æ’­æ”¾å™¨

2. **é‡æ„ç¼–è¾‘å™¨ä¸Šä¸‹æ–‡**
   - åˆ é™¤åˆ†é•œç›¸å…³çŠ¶æ€
   - æ·»åŠ è§†é¢‘ç›¸å…³çŠ¶æ€
   - æ›´æ–° actions å’Œ reducers

3. **æ¸…ç†å›½é™…åŒ–æ–‡ä»¶**
   - åˆ é™¤åˆ†é•œç›¸å…³æ–‡æ¡ˆ
   - æ·»åŠ è§†é¢‘ç›¸å…³æ–‡æ¡ˆ

### é•¿æœŸï¼ˆä¼˜åŒ–ï¼‰
1. **è§†é¢‘å‰ªè¾‘åŠŸèƒ½**
   - è§†é¢‘ç‰‡æ®µæ’åº
   - è½¬åœºæ•ˆæœ
   - æ—¶é•¿è°ƒæ•´

2. **è§†é¢‘å¯¼å‡ºä¼˜åŒ–**
   - å®é™…çš„ FFmpeg åˆæˆ
   - å¤šç§å¯¼å‡ºæ ¼å¼
   - å¯¼å‡ºè´¨é‡é€‰é¡¹

## ğŸ“ é‡è¦æé†’

1. **ä¸è¦è¿è¡Œæ—§ä»£ç ** - åˆ†é•œç›¸å…³çš„ä»£ç ä¼šå¯¼è‡´æ•°æ®åº“é”™è¯¯
2. **å‰ç«¯ä¼šæœ‰ç¼–è¯‘é”™è¯¯** - éœ€è¦é€æ­¥ä¿®å¤æˆ–æ³¨é‡Šæ‰æœ‰é—®é¢˜çš„ç»„ä»¶
3. **å…ˆå®Œæˆæ•°æ®åº“è¿ç§»** - å¦åˆ™åç«¯åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ
4. **é€æ­¥é‡æ„å‰ç«¯** - å¯ä»¥å…ˆæ³¨é‡Šæ‰æœ‰é—®é¢˜çš„ç»„ä»¶ï¼Œé€æ­¥æ›¿æ¢

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡é‡æ„æˆåŠŸå®Œæˆäº†åç«¯æ ¸å¿ƒæ¶æ„çš„è½¬æ¢ï¼Œä»"åˆ†é•œ"æ¦‚å¿µè¿ç§»åˆ°"è§†é¢‘ç‰‡æ®µ"æ¦‚å¿µã€‚åç«¯ APIã€Agent åŠŸèƒ½ã€Worker å¤„ç†å™¨éƒ½å·²æ›´æ–°å®Œæ¯•ï¼Œå¯ä»¥æ­£å¸¸å·¥ä½œã€‚

å‰ç«¯éƒ¨åˆ†å·²åˆ é™¤äº†æ‰€æœ‰åˆ†é•œç›¸å…³çš„ UI ç»„ä»¶ï¼Œä½†ç¼–è¾‘å™¨çš„æ ¸å¿ƒä¸Šä¸‹æ–‡å’Œ Agent é¢æ¿è¿˜éœ€è¦è¿›ä¸€æ­¥é‡æ„ã€‚å»ºè®®åœ¨å®Œæˆæ•°æ®åº“è¿ç§»å’Œåç«¯æµ‹è¯•åï¼Œå†é€æ­¥å¼€å‘æ–°çš„è§†é¢‘ç®¡ç† UIã€‚

é‡æ„çš„æ ¸å¿ƒç›®æ ‡å·²ç»è¾¾æˆï¼š**Agent ç°åœ¨å¯ä»¥ç›´æ¥ç”Ÿæˆå’Œç®¡ç†è§†é¢‘ç‰‡æ®µï¼Œè€Œä¸éœ€è¦é€šè¿‡åˆ†é•œè¿™ä¸ªä¸­é—´å±‚**ã€‚è¿™ä½¿å¾—å·¥ä½œæµæ›´åŠ æµç•…å’Œçµæ´»ã€‚

