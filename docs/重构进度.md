# åˆ†é•œæ¦‚å¿µåˆ é™¤ - é‡æ„è¿›åº¦

## å·²å®Œæˆ âœ…

### 1. æ•°æ®åº“ Schema (`src/lib/db/schemas/project.ts`)
- âœ… åˆ é™¤ `shot` è¡¨å®šä¹‰
- âœ… åˆ é™¤ `shotAsset` è¡¨å®šä¹‰  
- âœ… åˆ é™¤ `shotTransition` è¡¨å®šä¹‰
- âœ… åˆ é™¤ `shotSizeEnum` å’Œ `cameraMovementEnum`
- âœ… åˆ›å»ºæ–°çš„ `video` è¡¨
- âœ… åˆ›å»º `videoStatusEnum`
- âœ… æ›´æ–° relations

### 2. TypeScript ç±»å‹ (`src/types/project.ts`)
- âœ… åˆ é™¤ Shot, ShotAsset, ShotVideo ç±»å‹
- âœ… åˆ é™¤ ShotSize, CameraMovement ç±»å‹
- âœ… æ·»åŠ  Video, VideoDetail, VideoStatus ç±»å‹
- âœ… æ›´æ–° ProjectDetail å’Œ ProjectWithStats

### 3. Video Actions (`src/lib/actions/video/index.ts`)
- âœ… `getProjectVideos()` - è·å–é¡¹ç›®è§†é¢‘åˆ—è¡¨
- âœ… `getVideoById()` - è·å–å•ä¸ªè§†é¢‘è¯¦æƒ…
- âœ… `createVideoGeneration()` - åˆ›å»ºè§†é¢‘ç”Ÿæˆä»»åŠ¡
- âœ… `updateVideo()` - æ›´æ–°è§†é¢‘ä¿¡æ¯
- âœ… `deleteVideo()` - åˆ é™¤å•ä¸ªè§†é¢‘
- âœ… `deleteVideos()` - æ‰¹é‡åˆ é™¤è§†é¢‘
- âœ… `remixVideo()` - åŸºäºç°æœ‰è§†é¢‘ç”Ÿæˆæ–°è§†é¢‘

### 4. Job ç±»å‹ (`src/types/job.ts`)
- âœ… åˆ é™¤ `shot_video_generation` å’Œ `shot_tts_generation`
- âœ… æ›´æ–° `VideoGenerationInput` ä¸º `{ videoId: string }`
- âœ… åˆ é™¤ `ShotVideoGenerationInput` ç­‰ç±»å‹
- âœ… æ›´æ–° `FinalVideoExportInput` ä½¿ç”¨ videoIds

### 5. Agent Functions (`src/lib/actions/agent/functions.ts`)
- âœ… åˆ é™¤ `query_shots`, `create_shots`, `generate_shot_video`, `update_shots`, `delete_shots`
- âœ… æ·»åŠ  `query_videos` - æŸ¥è¯¢è§†é¢‘åˆ—è¡¨
- âœ… æ·»åŠ  `generate_video` - ç”Ÿæˆè§†é¢‘
- âœ… æ·»åŠ  `update_videos` - æ›´æ–°è§†é¢‘
- âœ… æ·»åŠ  `delete_videos` - åˆ é™¤è§†é¢‘
- âœ… æ›´æ–° `query_context` åŒ…å«è§†é¢‘ä¿¡æ¯

### 6. åˆ é™¤çš„æ–‡ä»¶
- âœ… `/src/lib/actions/project/shot.ts`
- âœ… `/src/lib/actions/project/shot-asset.ts`
- âœ… `/src/lib/actions/project/shot-video.ts`

### 7. æ›´æ–°çš„æ–‡ä»¶
- âœ… `/src/lib/actions/project/refresh.ts` - æ”¹ä¸º refreshVideo å’Œ refreshProjectVideos

## è¿›è¡Œä¸­ ğŸš§

### 8. Agent Executor (`src/lib/actions/agent/executor.ts`)
- âœ… æ›´æ–°å¯¼å…¥è¯­å¥
- âœ… æ›´æ–° `query_context` case
- âœ… æ›´æ–° `query_shots` â†’ `query_videos`
- âš ï¸ éœ€è¦æ›¿æ¢ `create_shots` caseï¼ˆå·²åºŸå¼ƒï¼‰
- âš ï¸ éœ€è¦æ›¿æ¢ `generate_shot_video` â†’ `generate_video`
- âš ï¸ éœ€è¦æ›¿æ¢ `update_shots` â†’ `update_videos`
- âš ï¸ éœ€è¦æ›¿æ¢ `delete_shots` â†’ `delete_videos`

## å¾…å®Œæˆ ğŸ“‹

### 9. Agent Validation (`src/lib/actions/agent/validation.ts`)
- âŒ æ›´æ–° `validateFunctionParameters` å‡½æ•°
- âŒ åˆ é™¤ `validateGenerateShotVideoParams`
- âŒ æ·»åŠ  `validateGenerateVideoParams`
- âŒ åˆ é™¤ `validateCreateShotsParams`

### 10. Job Workers (`src/lib/workers/`)
- âŒ æ›´æ–° `video-processors.ts` ä¸­çš„è§†é¢‘ç”Ÿæˆé€»è¾‘
- âŒ åˆ é™¤ shot_video_generation å¤„ç†å™¨
- âŒ åˆ é™¤ shot_tts_generation å¤„ç†å™¨
- âŒ æ›´æ–° final_video_export å¤„ç†å™¨

### 11. å‰ç«¯ç»„ä»¶ - åˆ é™¤
éœ€è¦åˆ é™¤ä»¥ä¸‹åˆ†é•œç›¸å…³ç»„ä»¶ï¼š
- âŒ `/src/components/projects/editor/preview-panel/shot-editor.tsx`
- âŒ `/src/components/projects/editor/preview-panel/shot-playback-player.tsx`
- âŒ `/src/components/projects/editor/preview-panel/storyboard-preview.tsx`
- âŒ `/src/components/projects/editor/resource-panel/storyboard-panel.tsx`
- âŒ `/src/components/projects/editor/timeline/shot-clip.tsx`
- âŒ `/src/components/projects/editor/timeline/timeline-container.tsx`
- âŒ `/src/components/projects/editor/timeline/timeline-toolbar.tsx`
- âŒ `/src/components/projects/editor/timeline/timeline-track.tsx`

### 12. å‰ç«¯ç»„ä»¶ - åˆ›å»º
éœ€è¦åˆ›å»ºæ–°çš„è§†é¢‘ç®¡ç†ç»„ä»¶ï¼š
- âŒ `/src/components/projects/editor/video-library/video-grid.tsx` - è§†é¢‘ç½‘æ ¼å±•ç¤º
- âŒ `/src/components/projects/editor/video-library/video-card.tsx` - è§†é¢‘å¡ç‰‡
- âŒ `/src/components/projects/editor/video-library/video-editor.tsx` - è§†é¢‘ç¼–è¾‘å™¨
- âŒ `/src/components/projects/editor/video-library/index.tsx` - è§†é¢‘åº“ä¸»ç»„ä»¶

### 13. å‰ç«¯ç»„ä»¶ - æ›´æ–°
- âŒ `/src/components/projects/editor/editor-context.tsx` - æ›´æ–°çŠ¶æ€ç®¡ç†
- âŒ `/src/components/projects/editor/editor-layout.tsx` - æ›´æ–°å¸ƒå±€
- âŒ `/src/components/projects/editor/preview-panel/preview-panel.tsx` - æ›´æ–°é¢„è§ˆé€»è¾‘
- âŒ `/src/components/projects/editor/resource-panel/resource-panel.tsx` - æ·»åŠ è§†é¢‘tab
- âŒ `/src/components/projects/editor/agent-panel/pending-action-message.tsx` - æ›´æ–°åˆ†é•œæ˜¾ç¤ºä¸ºè§†é¢‘

### 14. å¸¸é‡å’Œå·¥å…·å‡½æ•°
- âŒ åˆ é™¤ `/src/lib/constants/shot-asset-labels.ts`
- âŒ æ›´æ–° `/src/lib/constants/enums.ts` - åˆ é™¤ SHOT_SIZE_ENUM å’Œ CAMERA_MOVEMENT_ENUM
- âŒ æ›´æ–° `/src/lib/utils/credit-calculator.ts` - åˆ é™¤åˆ†é•œç›¸å…³è®¡è´¹
- âŒ åˆ é™¤ `/src/lib/prompts/shot.ts`
- âŒ æ›´æ–° `/src/lib/utils/motion-prompt.ts`

### 15. å›½é™…åŒ–æ–‡ä»¶
- âŒ æ›´æ–° `/messages/zh.json` - åˆ é™¤åˆ†é•œç›¸å…³æ–‡æ¡ˆ
- âŒ æ›´æ–° `/messages/en.json` - åˆ é™¤åˆ†é•œç›¸å…³æ–‡æ¡ˆ

### 16. å…¶ä»–
- âŒ æ›´æ–° `/src/hooks/use-task-refresh.ts` - åˆ é™¤åˆ†é•œåˆ·æ–°é€»è¾‘
- âŒ æ›´æ–° `/src/lib/actions/project/index.ts` - æ›´æ–°å¯¼å‡º
- âŒ æ›´æ–° `/src/lib/services/agent-engine/` - ç›¸å…³çš„ Agent å¼•æ“ä»£ç 

## æ•°æ®åº“è¿ç§»

âš ï¸ **ç”¨æˆ·éœ€è¦è‡ªè¡Œå¤„ç†æ•°æ®åº“è¿ç§»**

éœ€è¦åˆ›å»ºè¿ç§»è„šæœ¬ï¼š
1. åˆ›å»º `video` è¡¨
2. ï¼ˆå¯é€‰ï¼‰è¿ç§» `shot_video` æ•°æ®åˆ° `video` è¡¨
3. åˆ é™¤ `shot_transition` è¡¨
4. åˆ é™¤ `shot_asset` è¡¨
5. åˆ é™¤ `shot` è¡¨
6. åˆ é™¤ç›¸å…³çš„ enum ç±»å‹

## æµ‹è¯•æ¸…å•

å®Œæˆé‡æ„åéœ€è¦æµ‹è¯•ï¼š
- [ ] è§†é¢‘ç”ŸæˆåŠŸèƒ½
- [ ] è§†é¢‘åˆ—è¡¨æŸ¥è¯¢
- [ ] è§†é¢‘ç¼–è¾‘ï¼ˆprompt, title, tagsï¼‰
- [ ] è§†é¢‘åˆ é™¤
- [ ] Agent å¯¹è¯ä¸­çš„è§†é¢‘æ“ä½œ
- [ ] ç´ æå…³è”åˆ°è§†é¢‘
- [ ] è§†é¢‘å¯¼å‡ºåŠŸèƒ½

## æ³¨æ„äº‹é¡¹

1. **ä¸è¦è¿è¡Œæ—§çš„åˆ†é•œç›¸å…³ä»£ç ** - ä¼šå¯¼è‡´æ•°æ®åº“é”™è¯¯
2. **å‰ç«¯ä¼šæœ‰å¤§é‡ç¼–è¯‘é”™è¯¯** - éœ€è¦é€æ­¥ä¿®å¤
3. **Agent åŠŸèƒ½æš‚æ—¶ä¸å¯ç”¨** - ç›´åˆ° executor å®Œå…¨æ›´æ–°
4. **è§†é¢‘ç”Ÿæˆ worker éœ€è¦æ›´æ–°** - å¦åˆ™ä»»åŠ¡æ— æ³•æ‰§è¡Œ

